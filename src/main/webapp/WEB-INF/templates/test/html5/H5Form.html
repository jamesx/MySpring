<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <form id="order" name="order" method="post" action="/submit">
        <h1>Order Form</h1>
        <fieldset>
            <legend>Contact Details</legend>
            <ul>
                <li>
                    <label class="required">
                        <div>Full Name</div>
                        <input name="name" required autofocus>
                    </label>
                </li>
                <li>
                    <label class="required">
                        <div>Email Address</div>
                        <input name="email" type="email" required>
                    </label>
                </li>
                <li>
                    <label>
                        <div>Postal Address</div>
                        <input name="address1" placeholder="address Line 1">
                    </label>
                    <div>&nbsp;</div>
                    <input name="address2" placeholder="Address Line 2">
                    <div>&nbsp;</div>
                    <input name="city" list="city" type="city" placeholder="Town/City">
                    <datalist id="city">
                        <option>上海</option>
                        <option>北京</option>
                        <option>武汉</option>
                    </datalist>
                    <input name="state" placeholder="state">
                    <input name="zip" placeholder="zip Code">
                    <div>&nbsp;</div>
                    <select name="country">
                        <option value="0"> Country</option>
                        <option value="US">United States</option>
                        <option value="CA">Canada</option>
                    </select>
                </li>
                <li>
                    <label>
                        <div>Home Phone No.</div>
                        <input type="tel" name="homephone">
                    </label>
                </li>
                <li>
                    <label>
                        <div>Cell Phone No.</div>
                        <input type="tel" name="cellphone">
                    </label>
                </li>
                <li>
                    <div>Skype Name</div>
                    <input name="skype">
                </li>
                <li>
                    <div>Twitter</div>
                    <span class="twitter_prefix">@</span>
                    <input name="twitter" class="twitter">
                </li>
            </ul>
        </fieldset>
        <fieldset>
            <legend>Login Details</legend>
            <ul>
                <li>
                    <label class="required">
                        <div>Password</div>
                        <input type="passowrd" name="password" required>
                    </label>
                </li>
                <li>
                    <label class="required">
                        <div>Confirm Password</div>
                        <input type="password" name="confirm_password" required>
                    </label>
                </li>
            </ul>
        </fieldset>
        <fieldset>
            <legend>Order Details</legend>
            <table>
                <thead>
                <tr>
                    <th>Product Code</th>
                    <th>Description</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        COMP001
                        <input type="hidden" name="product_code" value="COMP001">
                    </td>
                    <td>The Ultimate Smartphone</td>
                    <td>
                        <input type="number" data-price="399.99" name="quantity" value="0" min="0" max="99" maxlength="2">
                    </td>
                    <td>
                        $399.99
                    </td>
                    <td>
                        <output name="item_total" class="item_total">$0.00</output>
                    </td>
                </tr>
                <tr>
                    <td>
                        COMP002
                        <input type="hidden" name="product_code" value="COMP002">
                    </td>
                    <td>
                        The Ultimate Tablet
                    </td>
                    <td>
                        <input type="number" data-price="499.99" name="quantity" value="0" min="0" max="99" maxlength="2">
                    </td>
                    <td>
                        $499.99
                    </td>
                    <td>
                        <output name="item_total" class="item_total">$0.00</output>
                    </td>
                </tr>
                <tr>
                    <td>
                        COMP003
                        <input type="hidden" name="product_code" value="COMP003">
                    </td>
                    <td>
                        The Ultimate Netbook
                    </td>
                    <td>
                        <input type="number" data-price="299.99" name="quantity" value="0" min="0" max="99" maxlength="2">
                    </td>
                    <td>$299.99</td>
                    <td>
                        <output name="item_total" class="item_total">$0.00</output>
                    </td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="4">Order Total</td>
                    <td>
                        <output name="order_total" id="order_total">$0.00</output>
                    </td>
                </tr>
                </tfoot>
            </table>
        </fieldset>
        <fieldset>
            <legend>Payment Details</legend>
            <ul>
                <li>
                    <label class="required">
                        <div>Name on Card</div>
                        <input name="card_name">
                    </label>
                </li>
                <li>
                    <label class="required">
                        <div>Credit Card No.</div>
                        <input name="card_number"  pattern="[0-9]{13,16}" maxlength="16" required titile="13-16 digits,no spaces">
                    </label>
                </li>
                <li>
                    <label class="required">
                        <div>Expiry Date</div>
                        <input type="month" name="card_expiry" maxlength="7" placeholder="YYY-MM" required value="2015-06">
                    </label>
                </li>
                <li>
                    <label>
                        <div>CVV2 No.</div>
                        <input name="div_cvv2" class="cvv" maxlength="3" pattern="[0-9]{3}" required title="exactly 3 digits">
                        <span>Three digit code at back of card</span>
                    </label>
                </li>
            </ul>
        </fieldset>
        <div>
            <input type="submit" value="Submit Order">
            <input type="submit" id="saveOrder" value="Save Order" formnovalidate formaction="/save">
        </div>
    </form>
<script>
    //计算金额求和
    var qtyFields=order.quantity,
        totalFields=document.getElementsByClassName("item_total"),
        orderTotalField=document.getElementById("order_total");
    var formatMoney=function (value) {
      return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
    }
    var calculateTotals=function () {
        var i=0,
        ln=qtyFields.length,
             itemQty=0,
            itemPrice=0.00,
            timeTotal=0.00,
            itemTotalMoney='$0.00',
            orderTotal=0.00,
            orderTotalMoney='$0.00';
        for(;i<ln;i++){
            if(!!qtyFields[i].valueAsNumber){
                itemQty=qtyFields[i].valueAsNumber||0;
            }else{
                itemQty=parseFloat(qtyFields[i].value);
            }
            itemPrice=parseFloat(qtyFields[i].dataset.price);
            itemTotal=itemQty*itemPrice;
            itemTotalMoney='$'+formatMoney(itemTotal.toFixed(2));
            orderTotal+=itemTotal;
            orderTotalMoney='$'+formatMoney(orderTotal.toFixed(2));
            totalFields[i].value=itemTotalMoney;
            orderTotalField.value=orderTotalMoney;
        }
    };
    calculateTotals();
    var qtyListeners=function () {
        var i=0,
            ln=qtyFields.length;
        for(;i<ln;i++){
            qtyFields[i].addEventListener('input', calculateTotals,false);
            qtyFields[i].addEventListener('keyup',calculateTotals,false);
        }

    }
    qtyListeners();
</script>
<script>
    var order=document.getElementById("order");
    var doCustomValidity=function (field,msg) {
        debugger
            field.setCustomValidity(msg)

    }
    var validateForm=function () {
        debugger
        doCustomValidity(order.name,"");
        doCustomValidity(order.password,"");
        doCustomValidity(order.confirm_password,"");
        doCustomValidity(order.card_name,"");
        if(order.name.value.length<4){
            doCustomValidity(order.name,"用户名不能少于4个字符");
        }
        if(order.password.length<8){
            doCustomValidity(order.password,"密码不能少于8个字符");
        }
        if(order.password.value!=order.confirm_password.value){
            doCustomValidity(order.confirm_password,"两次密码输入不一致");
        }
        if(order.card_name.value.length<4){
            doCustomValidity(order.card_name,"card不能少于4个字符");
        }
    }
    order.addEventListener('input',validateForm,false);
    order.addEventListener('keyup',validateForm,false);
</script>
</body>
</html>